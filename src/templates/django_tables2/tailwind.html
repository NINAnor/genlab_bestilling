{% load django_tables2 %}
{% load i18n %}
{% block table-wrapper %}
<div class="rounded-sm border border-stroke bg-white px-5 pb-2.5 pt-6 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1"
>
<div class="max-w-full overflow-x-auto mb-5">
    {% block table %}
        <table {% render_attrs table.attrs class="w-full table-auto tailwind-table" %}>
            {% block table.thead %}

            {% comment %}
            thead is the first row showing the column names. The is_urgent column is now forced
            first in line and does not have a visible column name, as opposed to the other columns.
            {% endcomment %}

            {% if table.show_header %}
                <thead {{ table.attrs.thead.as_html }}>
                    <tr>

                    {% comment %} Force the is_urgent column to be first in the header row. {% endcomment %}
                    {% for column in table.columns %}
                        {% if column.name == "is_urgent" %}
                            <th {{ column.attrs.th.as_html }}><a href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}"></a></th>
                        {% endif %}
                    {% endfor %}

                    {% comment %} Render the rest of the columns in the header row. {% endcomment %}
                    {% for column in table.columns %}
                        {% if column.name != "is_urgent" %}
                        <th {{ column.attrs.th.as_html }}>
                            {% if column.orderable %}
                                <a href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header }}</a>
                            {% else %}
                                {{ column.header }}
                            {% endif %}
                        </th>
                        {% endif %}
                    {% endfor %}
                    </tr>
                </thead>
            {% endif %}
            {% endblock table.thead %}


            {% block table.tbody %}
                <tbody {{ table.attrs.tbody.as_html }}>

                {% comment %}
                tbody is the rows with the data, matching the column names of the thead. The is_urgent column is also set to show
                first in the rows, just like in the thead. It is also overwritten to show the "True" value as an exclaimation mark, to highlight
                the urgent orders.
                {% endcomment %}

                {% for row in table.paginated_rows %}
                    {% block table.tbody.row %}
                    <tr {{ row.attrs.as_html }}>

                    {% comment %} Force the is_urgent column to be first in the row. {% endcomment %}
                    {% for column, cell in row.items %}
                        {% if column.name == "is_urgent" %}
                            <td {{ column.attrs.td.as_html }} style="text-align: right;">
                            {% comment %} Show an exclaimation mark if the cell value is True, otherwise show nothing. {% endcomment %}
                            {% if cell == True %}
                                <i class="fa-solid fa-exclamation text-red-500 fa-2x" title="Urgent"></i>
                            {% endif %}
                        </td>
                        {% endif %}
                    {% endfor %}

                    {% comment %} Render the rest of the columns in the row. {% endcomment %}
                    {% for column, cell in row.items %}
                        {% if column.name != "is_urgent" %}
                            <td {{ column.attrs.td.as_html }}>
                            {% if column.localize == None %}
                                {{ cell }}
                            {% else %}
                                {% if column.localize %}
                                    {{ cell|localize }}
                                {% else %}
                                    {{ cell|unlocalize }}
                                {% endif %}
                            {% endif %} </td>
                        {% endif %}
                    {% endfor %}
                    </tr>
                    {% endblock table.tbody.row %}
                {% empty %}
                    {% if table.empty_text %}
                    {% block table.tbody.empty_text %}
                        <tr><td class="text-center font-bold" colspan="{{ table.columns|length }}">{{ table.empty_text }}</td></tr>
                    {% endblock table.tbody.empty_text %}
                    {% endif %}
                {% endfor %}
                </tbody>
            {% endblock table.tbody %}


            {% block table.tfoot %}
            {% if table.has_footer %}
                <tfoot {{ table.attrs.tfoot.as_html }}>
                    <tr>
                    {% for column in table.columns %}
                        <td {{ column.attrs.tf.as_html }}>{{ column.footer }}</td>
                    {% endfor %}
                    </tr>
                </tfoot>
            {% endif %}
            {% endblock table.tfoot %}
        </table>
    {% endblock table %}

    {% block pagination %}
        {% if table.page and table.paginator.num_pages > 1 %}
        <nav aria-label="Table navigation">
            <ul class="pagination">
            {% if table.page.has_previous %}
                {% block pagination.previous %}
                    <li class="previous">
                        <a href="{% querystring table.prefixed_page_field=table.page.previous_page_number %}">
                            <span aria-hidden="true">&laquo;</span>
                            {% trans 'previous' %}
                        </a>
                    </li>
                {% endblock pagination.previous %}
            {% endif %}
            {% if table.page.has_previous or table.page.has_next %}
                {% block pagination.range %}
                    {% for p in table.page|table_page_range:table.paginator %}
                        <li {% if p == table.page.number %}class="active"{% endif %}>
                            {% if p == '...' %}
                                <a href="#">{{ p }}</a>
                            {% else %}
                                <a href="{% querystring table.prefixed_page_field=p %}">
                                    {{ p }}
                                </a>
                            {% endif %}
                        </li>
                    {% endfor %}
                {% endblock pagination.range %}
            {% endif %}

            {% if table.page.has_next %}
                {% block pagination.next %}
                <li class="next">
                    <a href="{% querystring table.prefixed_page_field=table.page.next_page_number %}">
                        {% trans 'next' %}
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% endblock pagination.next %}
            {% endif %}
            </ul>
        </nav>
        {% endif %}
    {% endblock pagination %}
    </div>
</div>
{% endblock table-wrapper %}
